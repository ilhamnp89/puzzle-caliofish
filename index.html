<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Produk CALIOFISH</title>

<style>
body{
  margin:0; padding:20px;
  font-family:Arial,sans-serif;
  background:#f2f2f2;
  text-align:center;
}
#levelInfo{font-weight:bold;font-size:1.2em;margin-bottom:5px;}
#timer{font-size:18px;}
#datetime{font-size:16px;margin-bottom:12px;}

.puzzle-wrapper{
  margin:0 auto 15px;
  border-radius:16px;
  overflow:hidden;
  background:url("bg-puzzle.png") center/cover no-repeat;
}

canvas{
  width:100%;
  max-width:400px;
  background:rgba(255,255,255,0.9);
  cursor:pointer;
  display:block;
  margin:0 auto;
}

button{
  margin:5px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
  cursor:pointer;
}

#levelComplete,#summary{
  margin-top:20px;
  background:white;
  padding:16px;
  border-radius:14px;
  display:none;
  z-index:10;
}

.confetti-piece{
  position:absolute;
  width:8px;
  height:8px;
  border-radius:50%;
  pointer-events:none;
  animation:confettiFall linear;
}

@keyframes confettiFall{
  to{transform:translateY(400px) rotate(360deg);opacity:0;}
}
</style>
</head>

<body>

<h2 id="levelInfo">Level 1 ‚Äî 2x2</h2>
<div id="timer">‚è±Ô∏è 00:00</div>
<div id="datetime">üìÖ ‚Äî</div>

<div class="puzzle-wrapper">
  <canvas id="puzzle" width="400" height="400"></canvas>
</div>

<div>
  <button id="startBtn">Mulai Puzzle</button>
  <button id="stopBtn">Stop</button>
  <button id="restartBtn">Restart Level</button>
</div>

<div id="levelComplete"></div>
<div id="summary"></div>

<script>
/* ================= JAM & TANGGAL ================= */
function updateDateTime(){
  const n=new Date();
  const hari=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
  const bulan=["Januari","Februari","Maret","April","Mei","Juni","Juli",
               "Agustus","September","Oktober","November","Desember"];
  document.getElementById("datetime").innerHTML=
    `üìÖ ${hari[n.getDay()]}, ${n.getDate()} ${bulan[n.getMonth()]} ${n.getFullYear()}
     ‚è∞ ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;
}
setInterval(updateDateTime,1000); updateDateTime();

/* ================= PUZZLE ================= */
const canvas=document.getElementById("puzzle");
const ctx=canvas.getContext("2d");
const timerEl=document.getElementById("timer");
const levelInfo=document.getElementById("levelInfo");
const levelCompleteEl=document.getElementById("levelComplete");
const summaryEl=document.getElementById("summary");

const startBtn=document.getElementById("startBtn");
const stopBtn=document.getElementById("stopBtn");
const restartBtn=document.getElementById("restartBtn");

const levels=[
 {size:2,img:"level1.jpg",label:"Level 1 ‚Äî 2x2"},
 {size:3,img:"level2.jpg",label:"Level 2 ‚Äî 3x3"},
 {size:4,img:"level3.jpg",label:"Level 3 ‚Äî 4x4"},
 {size:5,img:"level4.jpg",label:"Level 4 ‚Äî 5x5"}
];

let SIZE,board=[],emptyIndex,img=new Image();
let currentLevel=0,startTime,timerInterval,paused=false,levelTimes=[];

/* TIMER */
function startTimer(){
  startTime=Date.now();
  timerInterval=setInterval(()=>{
    if(!paused){
      let s=Math.floor((Date.now()-startTime)/1000);
      timerEl.textContent=`‚è±Ô∏è ${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
    }
  },500);
}
function stopTimer(){ clearInterval(timerInterval); }

/* INIT LEVEL */
function initLevel(){
  paused=false;
  stopBtn.textContent="Stop";
  levelCompleteEl.style.display="none";
  summaryEl.style.display="none";

  const lvl=levels[currentLevel];
  SIZE=lvl.size;
  levelInfo.textContent=lvl.label;
  timerEl.textContent="‚è±Ô∏è 00:00";

  img.src=lvl.img;
  img.onload=()=>{
    board=[...Array(SIZE*SIZE).keys()];
    emptyIndex=board.length-1;
    shuffle();
    draw();
    startTimer();
  };
}

/* DRAW */
function draw(){
  const t=canvas.width/SIZE;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<board.length;i++){
    if(board[i]===board.length-1) continue;
    const sx=(board[i]%SIZE)*(img.width/SIZE);
    const sy=Math.floor(board[i]/SIZE)*(img.height/SIZE);
    ctx.drawImage(img,sx,sy,img.width/SIZE,img.height/SIZE,
                  (i%SIZE)*t,Math.floor(i/SIZE)*t,t,t);
    ctx.strokeRect((i%SIZE)*t,Math.floor(i/SIZE)*t,t,t);
  }
}

/* LOGIC */
function shuffle(){
  for(let i=0;i<200;i++){
    const n=neighbors(emptyIndex);
    const m=n[Math.floor(Math.random()*n.length)];
    [board[emptyIndex],board[m]]=[board[m],board[emptyIndex]];
    emptyIndex=m;
  }
}
function neighbors(i){
  const r=Math.floor(i/SIZE),c=i%SIZE,res=[];
  if(r>0)res.push(i-SIZE);
  if(r<SIZE-1)res.push(i+SIZE);
  if(c>0)res.push(i-1);
  if(c<SIZE-1)res.push(i+1);
  return res;
}
function solved(){
  for(let i=0;i<board.length-1;i++){
    if(board[i]!==i) return false;
  }
  return true;
}

/* CLICK */
canvas.onclick=e=>{
  if(paused||!startTime) return;
  const r=canvas.getBoundingClientRect();
  const c=Math.floor((e.clientX-r.left)/(r.width/SIZE));
  const ro=Math.floor((e.clientY-r.top)/(r.height/SIZE));
  const i=ro*SIZE+c;
  if(neighbors(emptyIndex).includes(i)){
    [board[emptyIndex],board[i]]=[board[i],board[emptyIndex]];
    emptyIndex=i;
    draw();
    if(solved()){
      stopTimer();
      levelTimes.push(timerEl.textContent);
      playConfetti();
      currentLevel<levels.length-1 ? showLevelComplete() : showSummary();
    }
  }
};

/* POPUP */
function showLevelComplete(){
  levelCompleteEl.innerHTML=
    `<h3>üéâ SELAMAT!</h3>
     <p>${levels[currentLevel].label} selesai</p>
     <button id="nextLevelBtn">Next Level</button>`;
  levelCompleteEl.style.display="block";
  document.getElementById("nextLevelBtn").onclick=()=>{
    currentLevel++;
    initLevel();
  };
}

function showSummary(){
  summaryEl.innerHTML=
    `<h3>üèÜ Puzzle Selesai!</h3>
     <p>Kamu hebat üî•</p>`;
  summaryEl.style.display="block";
}

/* CONFETTI */
function playConfetti(){
  for(let i=0;i<40;i++){
    const c=document.createElement("div");
    c.className="confetti-piece";
    c.style.left=Math.random()*window.innerWidth+"px";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration=(1+Math.random()*2)+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  }
}

/* BUTTONS */
startBtn.onclick=()=>{ currentLevel=0; levelTimes=[]; initLevel(); };
stopBtn.onclick=()=>{ paused=!paused; stopBtn.textContent=paused?"Lanjutkan":"Stop"; };
restartBtn.onclick=()=>{ stopTimer(); initLevel(); };
</script>

</body>
</html>
