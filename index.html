<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Produk CALIOFISH</title>

<style>
body {
  margin:0; padding:20px;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  text-align:center;
}
#levelInfo { font-weight:bold; font-size:1.2em; margin-bottom:5px; }
#timer { font-size:18px; margin-bottom:4px; }
#datetime { font-size:14px; margin-bottom:10px; color:#555; }

/* Background gambar di belakang canvas */
.puzzle-wrapper {
  position: relative;
  margin:0 auto 15px;
  border-radius:16px;
  overflow:hidden;
  background: url("bg-puzzle.png") center/cover no-repeat;
}

canvas {
  width:100%;
  height:auto;
  max-width:400px;
  background: rgba(255,255,255,0.85);
  cursor:pointer;
  display:block;
  margin:0 auto;
}

button {
  margin:5px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
  cursor:pointer;
}

.cta { margin-top:20px; }
.cta a {
  background:#ff4d4d;
  color:white;
  text-decoration:none;
  padding:14px 22px;
  border-radius:12px;
  font-size:18px;
  font-weight:bold;
  display:inline-block;
}

#summary, #levelComplete {
  margin-top:20px;
  background:white;
  padding:16px;
  border-radius:14px;
  display:none;
}

.confetti-piece {
  position:absolute;
  width:8px;
  height:8px;
  opacity:0.8;
  pointer-events:none;
  animation: confettiFall linear;
  border-radius:50%;
}

@keyframes confettiFall {
  0% {transform: translateY(0) rotate(0deg);}
  100% {transform: translateY(400px) rotate(360deg); opacity:0;}
}
</style>
</head>

<body>

<h2 id="levelInfo">Level 1 ‚Äî 2x2</h2>
<div id="timer">‚è±Ô∏è 00:00</div>
<div id="datetime"></div>

<div class="puzzle-wrapper">
  <canvas id="puzzle" width="400" height="400"></canvas>
</div>

<div>
  <button id="startBtn">Mulai Puzzle</button>
  <button id="stopBtn">Stop</button>
  <button id="restartBtn">Restart Level</button>
</div>

<div id="levelComplete"></div>
<div id="summary"></div>

<div class="cta">
  <a href="https://shopee.co.id/caliofish.official" target="_blank">
    üõí Beli Sekarang
  </a>
</div>

<script>
/* ===== JAM & TANGGAL REALTIME ===== */
function updateDateTime() {
  const now = new Date();
  const tanggal = now.toLocaleDateString("id-ID", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric"
  });
  const jam = now.toLocaleTimeString("id-ID");
  document.getElementById("datetime").innerHTML =
    `üìÖ ${tanggal} | ‚è∞ ${jam}`;
}
setInterval(updateDateTime, 1000);
updateDateTime();

/* ===== PUZZLE ===== */
const canvas=document.getElementById("puzzle");
const ctx=canvas.getContext("2d");
const levelInfo=document.getElementById("levelInfo");
const timerEl=document.getElementById("timer");
const startBtn=document.getElementById("startBtn");
const stopBtn=document.getElementById("stopBtn");
const restartBtn=document.getElementById("restartBtn");
const summaryEl=document.getElementById("summary");
const levelCompleteEl=document.getElementById("levelComplete");

const SHOP_LINK="https://shopee.co.id/caliofish.official";

const levels=[
  {size:2,img:"level1.jpg",label:"Level 1 ‚Äî 2x2"},
  {size:3,img:"level2.jpg",label:"Level 2 ‚Äî 3x3"},
  {size:4,img:"level3.jpg",label:"Level 3 ‚Äî 4x4"},
  {size:5,img:"level4.jpg",label:"Level 4 ‚Äî 5x5"}
];

let currentLevel=0,SIZE=2,board=[],emptyIndex=0,img=new Image();
let startTime=null,timerInterval=null,levelTimes=[],paused=false;

/* TIMER PUZZLE */
function startTimer(){
  startTime=Date.now();
  timerInterval=setInterval(updateTimer,500);
}
function stopTimer(){ clearInterval(timerInterval); }
function updateTimer(){
  if(!paused){
    const sec=Math.floor((Date.now()-startTime)/1000);
    timerEl.textContent=`‚è±Ô∏è ${String(Math.floor(sec/60)).padStart(2,"0")}:${String(sec%60).padStart(2,"0")}`;
  }
}

/* PUZZLE LOGIC */
function initLevel(){
  paused=false;
  levelCompleteEl.style.display="none";
  summaryEl.style.display="none";
  const level=levels[currentLevel];
  SIZE=level.size;
  levelInfo.textContent=level.label;
  timerEl.textContent="‚è±Ô∏è 00:00";
  img.src=level.img;
  img.onload=()=>{
    board=[...Array(SIZE*SIZE).keys()];
    emptyIndex=board.length-1;
    shuffle(); draw(); startTimer();
  };
}
function draw(){
  const tile=canvas.width/SIZE;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<board.length;i++){
    if(board[i]===board.length-1) continue;
    ctx.drawImage(
      img,
      (board[i]%SIZE)*(img.width/SIZE),
      Math.floor(board[i]/SIZE)*(img.height/SIZE),
      img.width/SIZE,img.height/SIZE,
      (i%SIZE)*tile,Math.floor(i/SIZE)*tile,
      tile,tile
    );
    ctx.strokeRect((i%SIZE)*tile,Math.floor(i/SIZE)*tile,tile,tile);
  }
}
function shuffle(){
  for(let i=0;i<150;i++){
    const n=neighbors(emptyIndex);
    const m=n[Math.floor(Math.random()*n.length)];
    [board[emptyIndex],board[m]]=[board[m],board[emptyIndex]];
    emptyIndex=m;
  }
}
function neighbors(i){
  const r=Math.floor(i/SIZE),c=i%SIZE,res=[];
  if(r>0) res.push(i-SIZE);
  if(r<SIZE-1) res.push(i+SIZE);
  if(c>0) res.push(i-1);
  if(c<SIZE-1) res.push(i+1);
  return res;
}
function solved(){ return board.every((v,i)=>v===i); }

canvas.addEventListener("click",e=>{
  if(!startTime||paused) return;
  const rect=canvas.getBoundingClientRect();
  const idx=Math.floor((e.clientY-rect.top)/(rect.height/SIZE))*SIZE+
            Math.floor((e.clientX-rect.left)/(rect.width/SIZE));
  if(neighbors(emptyIndex).includes(idx)){
    [board[emptyIndex],board[idx]]=[board[idx],board[emptyIndex]];
    emptyIndex=idx; draw();
    if(solved()){ stopTimer(); playConfetti(); }
  }
});

/* CONFETTI */
function playConfetti(){
  for(let i=0;i<50;i++){
    const c=document.createElement("div");
    c.className="confetti-piece";
    c.style.left=Math.random()*canvas.offsetWidth+"px";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration=(1+Math.random()*1.5)+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  }
}

/* BUTTONS */
startBtn.onclick=()=>initLevel();
stopBtn.onclick=()=>{ paused=!paused; stopBtn.textContent=paused?"Lanjutkan":"Stop"; };
restartBtn.onclick=()=>{ stopTimer(); initLevel(); };
</script>

</body>
</html>
