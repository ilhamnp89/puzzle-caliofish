<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Produk CALIOFISH</title>

<style>
body {
  margin:0; padding:20px;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  text-align:center;
}
#levelInfo { font-weight:bold; font-size:1.2em; margin-bottom:5px; }
#timer { font-size:18px; margin-bottom:10px; }

/* Puzzle wrapper dengan background gambar penuh */
.puzzle-wrapper {
  position: relative;
  margin:0 auto 15px;
  border-radius:16px;
  overflow:hidden;
  background: url("bg-puzzle.png") center/cover no-repeat;
}

canvas {
  position: relative;
  width:100%;
  height:auto;
  max-width:400px;
  background: rgba(255,255,255,0.85); /* overlay putih kecil agar puzzle terlihat jelas */
  cursor:pointer;
  display:block;
  margin:0 auto;
}

button {
  margin:5px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
  cursor:pointer;
}

.cta { margin-top:20px; }
.cta a {
  background:#ff4d4d;
  color:white;
  text-decoration:none;
  padding:14px 22px;
  border-radius:12px;
  font-size:18px;
  font-weight:bold;
  display:inline-block;
}

#summary, #levelComplete {
  margin-top:20px;
  background:white;
  padding:16px;
  border-radius:14px;
  display:none;
  animation: fadeIn 0.7s ease forwards;
}

@keyframes fadeIn {
  from {opacity:0; transform: translateY(-10px);}
  to {opacity:1; transform: translateY(0);}
}

.confetti-piece {
  position:absolute;
  width:8px;
  height:8px;
  opacity:0.8;
  pointer-events:none;
  animation: confettiFall linear;
  border-radius:50%;
}

@keyframes confettiFall {
  0% {transform: translateY(0) rotate(0deg);}
  100% {transform: translateY(400px) rotate(360deg); opacity:0;}
}
</style>
</head>
<body>

<h2 id="levelInfo">Level 1 ‚Äî 2x2</h2>
<div id="timer">‚è±Ô∏è 00:00</div>

<div class="puzzle-wrapper">
  <canvas id="puzzle" width="400" height="400"></canvas>
</div>

<div>
  <button id="startBtn">Mulai Puzzle</button>
  <button id="stopBtn">Stop</button>
  <button id="restartBtn">Restart Level</button>
</div>

<div id="levelComplete"></div>
<div id="summary"></div>

<div class="cta">
  <a href="https://shopee.co.id/caliofish.official" target="_blank">üõí Beli Sekarang</a>
</div>

<script>
const canvas=document.getElementById("puzzle");
const ctx=canvas.getContext("2d");
const levelInfo=document.getElementById("levelInfo");
const timerEl=document.getElementById("timer");
const startBtn=document.getElementById("startBtn");
const stopBtn=document.getElementById("stopBtn");
const restartBtn=document.getElementById("restartBtn");
const summaryEl=document.getElementById("summary");
const levelCompleteEl=document.getElementById("levelComplete");

const SHOP_LINK="https://shopee.co.id/caliofish.official";

const levels=[
  {size:2,img:"level1.jpg",label:"Level 1 ‚Äî 2x2"},
  {size:3,img:"level2.jpg",label:"Level 2 ‚Äî 3x3"},
  {size:4,img:"level3.jpg",label:"Level 3 ‚Äî 4x4"},
  {size:5,img:"level4.jpg",label:"Level 4 ‚Äî 5x5"}
];

let currentLevel=0,SIZE=2,board=[],emptyIndex=0,img=new Image();
let startTime=null,timerInterval=null,levelTimes=[],paused=false;

/* TIMER */
function startTimer(){ startTime=Date.now(); timerInterval=setInterval(updateTimer,500);}
function stopTimer(){clearInterval(timerInterval);}
function updateTimer(){
  if(!paused){
    const diff=Date.now()-startTime;
    const sec=Math.floor(diff/1000);
    const m=String(Math.floor(sec/60)).padStart(2,"0");
    const s=String(sec%60).padStart(2,"0");
    timerEl.textContent=`‚è±Ô∏è ${m}:${s}`;
  }
}
function timeToSeconds(t){ const [m,s]=t.replace("‚è±Ô∏è ","").split(":").map(Number); return m*60+s;}

/* PUZZLE LOGIC */
function initLevel(){
  paused=false;
  levelCompleteEl.style.display="none";
  summaryEl.style.display="none";
  const level=levels[currentLevel];
  SIZE=level.size;
  levelInfo.textContent=level.label;
  timerEl.textContent="‚è±Ô∏è 00:00";
  img.src=level.img;
  img.onload=()=>{ board=[...Array(SIZE*SIZE).keys()]; emptyIndex=board.length-1; shuffle(); draw(); startTimer(); };
}
function draw(){
  const tile=canvas.width/SIZE;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let i=0;i<board.length;i++){
    if(board[i]===board.length-1) continue;
    const sx=(board[i]%SIZE)*(img.width/SIZE);
    const sy=Math.floor(board[i]/SIZE)*(img.height/SIZE);
    const dx=(i%SIZE)*tile;
    const dy=Math.floor(i/SIZE)*tile;
    ctx.drawImage(img,sx,sy,img.width/SIZE,img.height/SIZE,dx,dy,tile,tile);
    ctx.strokeRect(dx,dy,tile,tile);
  }
}
function shuffle(){ for(let i=0;i<150;i++){ const n=neighbors(emptyIndex); const move=n[Math.floor(Math.random()*n.length)]; [board[emptyIndex],board[move]]=[board[move],board[emptyIndex]]; emptyIndex=move; } }
function neighbors(i){ const r=Math.floor(i/SIZE),c=i%SIZE,res=[]; if(r>0) res.push(i-SIZE); if(r<SIZE-1) res.push(i+SIZE); if(c>0) res.push(i-1); if(c<SIZE-1) res.push(i+1); return res;}
function solved(){return board.every((v,i)=>v===i);}

/* CLICK PUZZLE */
canvas.addEventListener("click",e=>{
  if(!startTime||paused) return;
  const rect=canvas.getBoundingClientRect();
  const col=Math.floor((e.clientX-rect.left)/(rect.width/SIZE));
  const row=Math.floor((e.clientY-rect.top)/(rect.height/SIZE));
  const index=row*SIZE+col;
  if(neighbors(emptyIndex).includes(index)){
    [board[emptyIndex],board[index]]=[board[index],board[emptyIndex]];
    emptyIndex=index;
    draw();
    if(solved()){
      stopTimer();
      levelTimes.push(timerEl.textContent);
      playConfetti();
      if(currentLevel<levels.length-1) showLevelComplete();
      else showSummary();
    }
  }
});

/* LEVEL COMPLETE POP-UP */
function showLevelComplete(){
  levelCompleteEl.innerHTML=`
    <h3>üéâ SELAMAT!</h3>
    <p>Kamu menyelesaikan ${levels[currentLevel].label}</p>
    <button id="nextLevelBtn">Next Level</button>
  `;
  levelCompleteEl.style.display="block";
  document.getElementById("nextLevelBtn").addEventListener("click",()=>{
    currentLevel++; initLevel(); playConfetti();
  });
}

/* SUMMARY FINAL */
function showSummary(){
  let total=0;
  levelTimes.forEach(t=>total+=timeToSeconds(t));
  let badge="ü•â Pemula Hebat";
  if(total<300) badge="ü•à Puzzle Master";
  if(total<180) badge="ü•á Otak Tajam + Produk Tepat!";
  const m=Math.floor(total/60),s=total%60;
  summaryEl.innerHTML=`
    <h3>${badge}</h3>
    <p>Total waktu kamu: <strong>${m}:${String(s).padStart(2,"0")}</strong></p>
    <p>Produk ini cocok banget buat kamu üëá</p>
    <a href="${SHOP_LINK}" target="_blank"
       style="display:inline-block;margin-top:10px;background:#ff4d4d;color:#fff;
       padding:14px 22px;border-radius:12px;font-weight:bold;text-decoration:none;">
       üõí Beli Sekarang
    </a>
  `;
  summaryEl.style.display="block";
  playConfetti();
}

/* CONFETTI */
function playConfetti(){
  for(let i=0;i<50;i++){
    const conf=document.createElement("div");
    conf.classList.add("confetti-piece");
    conf.style.left=Math.random()*canvas.offsetWidth+"px";
    conf.style.background=`hsl(${Math.random()*360},100%,50%)`;
    conf.style.animationDuration=(1+Math.random()*1.5)+"s";
    document.body.appendChild(conf);
    setTimeout(()=>conf.remove(),3000);
  }
}

/* BUTTONS */
startBtn.addEventListener("click",()=>{ stopTimer(); currentLevel=0; levelTimes=[]; initLevel(); });
stopBtn.addEventListener("click",()=>{ paused=!paused; stopBtn.textContent=paused?"Lanjutkan":"Stop"; });
restartBtn.addEventListener("click",()=>{ stopTimer(); initLevel(); });

</script>
</body>
</html>
