<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Puzzle Produk CALIOFISH</title>

<style>
body {
  margin:0; padding:20px;
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  text-align:center;
}
#levelInfo { font-size:1.2em; font-weight:bold; }
#timer { font-size:18px; }
#datetime { font-size:14px; color:#555; margin-bottom:10px; }

.puzzle-wrapper {
  margin:0 auto 15px;
  max-width:400px;
  border-radius:16px;
  overflow:hidden;
  background:url("bg-puzzle.png") center/cover no-repeat;
}

canvas {
  width:100%;
  background:rgba(255,255,255,0.85);
  display:block;
}

button {
  margin:5px;
  padding:10px 18px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#007bff;
  color:white;
  cursor:pointer;
}

#levelComplete, #summary {
  display:none;
  background:white;
  margin-top:20px;
  padding:16px;
  border-radius:14px;
}

.cta a {
  display:inline-block;
  margin-top:20px;
  background:#ff4d4d;
  color:white;
  padding:14px 22px;
  border-radius:12px;
  text-decoration:none;
  font-weight:bold;
}

.confetti-piece {
  position:absolute;
  width:8px;
  height:8px;
  animation:confettiFall linear;
  border-radius:50%;
}

@keyframes confettiFall {
  to { transform:translateY(400px) rotate(360deg); opacity:0; }
}
</style>
</head>

<body>

<h2 id="levelInfo">Level 1 ‚Äî 2x2</h2>
<div id="timer">‚è±Ô∏è 00:00</div>
<div id="datetime"></div>

<div class="puzzle-wrapper">
  <canvas id="puzzle" width="400" height="400"></canvas>
</div>

<div>
  <button id="startBtn">Mulai</button>
  <button id="stopBtn">Stop</button>
  <button id="restartBtn">Restart</button>
</div>

<div id="levelComplete"></div>
<div id="summary"></div>

<div class="cta">
  <a href="https://shopee.co.id/caliofish.official" target="_blank">
    üõí Beli Sekarang
  </a>
</div>

<script>
/* ================= JAM & TANGGAL ================= */
function updateDateTime(){
  const n=new Date();
  document.getElementById("datetime").innerText =
    n.toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric"})
    +" | "+n.toLocaleTimeString("id-ID");
}
setInterval(updateDateTime,1000); updateDateTime();

/* ================= PUZZLE ================= */
const canvas=puzzle,ctx=canvas.getContext("2d");
const timerEl=timer,levelInfoEl=levelInfo;
const levelCompleteEl=levelComplete,summaryEl=summary;

const levels=[
  {size:2,img:"level1.jpg",label:"Level 1 ‚Äî 2x2"},
  {size:3,img:"level2.jpg",label:"Level 2 ‚Äî 3x3"},
  {size:4,img:"level3.jpg",label:"Level 3 ‚Äî 4x4"}
];

let currentLevel=0,SIZE,board=[],emptyIndex,img=new Image();
let startTime,timerInterval,paused=false,levelTimes=[];

/* TIMER */
function startTimer(){
  startTime=Date.now();
  timerInterval=setInterval(()=>{
    if(!paused){
      const s=Math.floor((Date.now()-startTime)/1000);
      timerEl.innerText=`‚è±Ô∏è ${String(s/60|0).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;
    }
  },500);
}
function stopTimer(){ clearInterval(timerInterval); }

/* INIT */
function initLevel(){
  paused=false;
  levelCompleteEl.style.display=summaryEl.style.display="none";
  const L=levels[currentLevel];
  SIZE=L.size;
  levelInfoEl.innerText=L.label;
  timerEl.innerText="‚è±Ô∏è 00:00";
  img.src=L.img;
  img.onload=()=>{
    board=[...Array(SIZE*SIZE).keys()];
    emptyIndex=board.length-1;
    shuffle(); draw(); startTimer();
  };
}

/* DRAW */
function draw(){
  const t=canvas.width/SIZE;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  board.forEach((v,i)=>{
    if(v===board.length-1) return;
    ctx.drawImage(img,
      (v%SIZE)*(img.width/SIZE),
      (v/SIZE|0)*(img.height/SIZE),
      img.width/SIZE,img.height/SIZE,
      (i%SIZE)*t,(i/SIZE|0)*t,t,t);
    ctx.strokeRect((i%SIZE)*t,(i/SIZE|0)*t,t,t);
  });
}

/* LOGIC */
function shuffle(){
  for(let i=0;i<150;i++){
    const n=neighbors(emptyIndex);
    const m=n[Math.random()*n.length|0];
    [board[emptyIndex],board[m]]=[board[m],board[emptyIndex]];
    emptyIndex=m;
  }
}
function neighbors(i){
  const r=i/SIZE|0,c=i%SIZE,res=[];
  if(r>0)res.push(i-SIZE);
  if(r<SIZE-1)res.push(i+SIZE);
  if(c>0)res.push(i-1);
  if(c<SIZE-1)res.push(i+1);
  return res;
}
function solved(){ return board.every((v,i)=>v===i); }

/* CLICK */
canvas.onclick=e=>{
  if(paused||!startTime) return;
  const r=canvas.getBoundingClientRect();
  const i=((e.clientY-r.top)/(r.height/SIZE)|0)*SIZE+
          ((e.clientX-r.left)/(r.width/SIZE)|0);
  if(neighbors(emptyIndex).includes(i)){
    [board[emptyIndex],board[i]]=[board[i],board[emptyIndex]];
    emptyIndex=i; draw();
    if(solved()){
      stopTimer();
      levelTimes.push(timerEl.innerText);
      playConfetti();
      currentLevel<levels.length-1 ? showLevelComplete() : showSummary();
    }
  }
};

/* POPUP */
function showLevelComplete(){
  levelCompleteEl.innerHTML=`
    <h3>üéâ Level Selesai</h3>
    <button id="next">Next Level</button>`;
  levelCompleteEl.style.display="block";
  next.onclick=()=>{ currentLevel++; initLevel(); };
}
function showSummary(){
  summaryEl.innerHTML=`<h3>üéâ Semua Level Selesai!</h3>`;
  summaryEl.style.display="block";
}

/* CONFETTI */
function playConfetti(){
  for(let i=0;i<40;i++){
    const c=document.createElement("div");
    c.className="confetti-piece";
    c.style.left=Math.random()*innerWidth+"px";
    c.style.background=`hsl(${Math.random()*360},100%,50%)`;
    c.style.animationDuration=1+Math.random()*1.5+"s";
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),3000);
  }
}

/* BUTTON */
startBtn.onclick=()=>{ currentLevel=0; levelTimes=[]; initLevel(); };
stopBtn.onclick=()=>{ paused=!paused; stopBtn.innerText=paused?"Lanjutkan":"Stop"; };
restartBtn.onclick=()=>{ stopTimer(); initLevel(); };
</script>

</body>
</html>
